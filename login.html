<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Campus Connect | Login</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: radial-gradient(circle at center, #8b1e1e 0%, #310808 100%);
      min-height: 100vh;
    }
    .background-overlay {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background: url('https://images.unsplash.com/photo-1518199266791-739d6ff26df5?q=80&w=2070&auto=format&fit=crop') center/cover;
      filter: blur(20px) brightness(0.4);
      z-index: 0;
    }
    #root {
      position: relative;
      z-index: 1;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    .btn-valentine {
      background: linear-gradient(90deg, #8b1e1e, #d64545);
      box-shadow: 0 4px 15px rgba(139, 30, 30, 0.4);
    }
    .btn-valentine:hover {
      box-shadow: 0 6px 20px rgba(139, 30, 30, 0.6);
    }
  </style>
</head>
<body>
  <div class="background-overlay"></div>
  <div id="root"></div>

  <script type="text/babel">
    /* ================= FIREBASE CONFIG ================= */
    const firebaseConfig = {
      apiKey: "AIzaSyBBl4QWQXIhNtUQVHajwaCeL7a69FYeXIc",
      authDomain: "datingapp-c9511.firebaseapp.com",
      projectId: "datingapp-c9511",
      storageBucket: "datingapp-c9511.firebasestorage.app",
      messagingSenderId: "232861031726",
      appId: "1:232861031726:web:6cfe58feda9c4563a12ebf",
      measurementId: "G-K9Z221KQB2"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    const googleProvider = new firebase.auth.GoogleAuthProvider();

    /* ================= AUTO REDIRECT ================= */
    auth.onAuthStateChanged((user) => {
      if (user) {
        window.location.href = "dashboard.html";
      }
    });

    /* ================= ICONS ================= */
    const Mail = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
    );

    const Lock = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
      </svg>
    );

    const Eye = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
      </svg>
    );

    const EyeOff = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
      </svg>
    );

    const AlertTriangle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
    );

    const Loader = ({ className }) => (
      <svg className={`${className} animate-spin`} fill="none" viewBox="0 0 24 24">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    );

    const Heart = ({ className, fill }) => (
      <svg className={className} fill={fill || "none"} stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
      </svg>
    );

    /* ================= LOGIN COMPONENT ================= */
    function Login() {
      const [email, setEmail] = React.useState("");
      const [password, setPassword] = React.useState("");
      const [showPassword, setShowPassword] = React.useState(false);
      const [error, setError] = React.useState("");
      const [success, setSuccess] = React.useState("");
      const [loading, setLoading] = React.useState(false);

      const isCollegeEmail = (email) =>
        email.endsWith(".ac.in") || email.endsWith(".edu");

      const checkUserProfile = async (user) => {
        try {
          const userDoc = await db.collection("users").doc(user.uid).get();

          if (!userDoc.exists) {
            // Check by email as fallback
            const snap = await db
              .collection("users")
              .where("collegeEmail", "==", user.email)
              .get();

            if (snap.empty) {
              await auth.signOut();
              setError("Account not found. Please complete registration first.");
              return;
            }
          }

          // Successful login
          window.location.href = "dashboard.html";
        } catch (err) {
          console.error("Error checking profile:", err);
          setError("Failed to verify profile. Please try again.");
        }
      };

      const loginWithEmail = async (e) => {
        e.preventDefault();
        setError("");
        setSuccess("");
        setLoading(true);

        if (!email || !password) {
          setError("Please enter both email and password.");
          setLoading(false);
          return;
        }

        if (!isCollegeEmail(email)) {
          setError("Only college email IDs (.ac.in or .edu) are allowed.");
          setLoading(false);
          return;
        }

        try {
          const res = await auth.signInWithEmailAndPassword(email, password);
          await checkUserProfile(res.user);
        } catch (err) {
          console.error("Login error:", err);
          
          switch (err.code) {
            case 'auth/user-not-found':
              setError("No account found with this email. Please register first.");
              break;
            case 'auth/wrong-password':
              setError("Incorrect password. Please try again.");
              break;
            case 'auth/invalid-email':
              setError("Invalid email format.");
              break;
            case 'auth/too-many-requests':
              setError("Too many failed attempts. Please try again later.");
              break;
            default:
              setError("Login failed. Please check your credentials.");
          }
        } finally {
          setLoading(false);
        }
      };

      const loginWithGoogle = async () => {
        setError("");
        setSuccess("");
        setLoading(true);

        try {
          const res = await auth.signInWithPopup(googleProvider);
          const userEmail = res.user.email;

          if (!isCollegeEmail(userEmail)) {
            await auth.signOut();
            setError("Only college Google accounts (.ac.in or .edu) are allowed.");
            setLoading(false);
            return;
          }

          await checkUserProfile(res.user);
        } catch (err) {
          console.error("Google login error:", err);
          
          if (err.code === 'auth/popup-closed-by-user') {
            setError("Login cancelled.");
          } else if (err.code === 'auth/popup-blocked') {
            setError("Popup blocked. Please allow popups for this site.");
          } else {
            setError("Google login failed. Please try again.");
          }
        } finally {
          setLoading(false);
        }
      };

      const sendPasswordReset = async () => {
        if (!email) {
          setError("Please enter your email first.");
          return;
        }

        if (!isCollegeEmail(email)) {
          setError("Please enter a valid college email.");
          return;
        }

        setLoading(true);
        setError("");
        setSuccess("");

        try {
          await auth.sendPasswordResetEmail(email);
          setSuccess("Password reset link sent to your email!");
          setError("");
        } catch (err) {
          console.error("Password reset error:", err);
          
          if (err.code === 'auth/user-not-found') {
            setError("No account found with this email.");
          } else {
            setError("Failed to send reset email. Please try again.");
          }
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="min-h-screen flex items-center justify-center px-4 py-8">
          <div className="w-full max-w-md">
            {/* Brand Header */}
            <div className="text-center mb-8">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-rose-400 to-pink-600 mb-4">
                <Heart className="w-8 h-8 text-white" fill="white" />
              </div>
              <h1 className="text-4xl font-bold text-yellow-200 mb-2" style={{ letterSpacing: '2px' }}>
                YOUR â™¡ VALENTINE
              </h1>
              <p className="text-white text-lg">
                Welcome back, love waits on campus ðŸ’˜
              </p>
            </div>

            {/* Glass Card */}
            <div className="glass-card rounded-3xl p-8">
              <form onSubmit={loginWithEmail} className="space-y-4">
                {error && (
                  <div className="flex items-start gap-2 bg-red-900 bg-opacity-40 text-red-300 p-3 rounded-lg text-sm">
                    <AlertTriangle className="w-4 h-4 mt-0.5 flex-shrink-0" />
                    <span>{error}</span>
                  </div>
                )}

                {success && (
                  <div className="bg-green-900 bg-opacity-40 text-green-300 p-3 rounded-lg text-sm">
                    {success}
                  </div>
                )}

                <div>
                  <label className="block text-sm font-medium text-white mb-2">
                    College Email
                  </label>
                  <div className="relative">
                    <Mail className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
                    <input
                      type="email"
                      placeholder="your.email@college.ac.in"
                      value={email}
                      onChange={(e) => setEmail(e.target.value.toLowerCase())}
                      className="w-full pl-10 pr-4 py-3 rounded-xl bg-white bg-opacity-90 focus:bg-opacity-100 focus:outline-none border-2 border-white border-opacity-30 focus:border-opacity-50 transition-all"
                      disabled={loading}
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-white mb-2">
                    Password
                  </label>
                  <div className="relative">
                    <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
                    <input
                      type={showPassword ? "text" : "password"}
                      placeholder="Enter your password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className="w-full pl-10 pr-12 py-3 rounded-xl bg-white bg-opacity-90 focus:bg-opacity-100 focus:outline-none border-2 border-white border-opacity-30 focus:border-opacity-50 transition-all"
                      disabled={loading}
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                      disabled={loading}
                    >
                      {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                    </button>
                  </div>
                </div>

                <div className="flex items-center justify-between">
                  <button
                    type="button"
                    onClick={sendPasswordReset}
                    className="text-sm text-yellow-200 hover:underline disabled:opacity-50"
                    disabled={loading}
                  >
                    Forgot password?
                  </button>
                </div>

                <button
                  type="submit"
                  disabled={loading}
                  className="w-full py-3 btn-valentine text-white rounded-xl font-semibold hover:shadow-lg transform hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                >
                  {loading ? (
                    <>
                      <Loader className="w-5 h-5" />
                      Logging in...
                    </>
                  ) : (
                    'Login'
                  )}
                </button>

                <div className="flex items-center my-4">
                  <div className="flex-1 h-px bg-white bg-opacity-30"></div>
                  <span className="px-3 text-white text-sm">OR</span>
                  <div className="flex-1 h-px bg-white bg-opacity-30"></div>
                </div>

                <button
                  type="button"
                  onClick={loginWithGoogle}
                  disabled={loading}
                  className="w-full py-3 bg-white text-gray-800 rounded-xl font-semibold flex items-center justify-center gap-2 hover:bg-opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <img
                    src="https://www.svgrepo.com/show/475656/google-color.svg"
                    className="w-5 h-5"
                    alt="Google"
                  />
                  Continue with Google
                </button>

                <div className="text-center pt-4">
                  <p className="text-sm text-white">
                    New here?{" "}
                    <a
                      href="register.html"
                      className="text-yellow-200 font-semibold hover:underline"
                    >
                      Create account
                    </a>
                  </p>
                </div>
              </form>
            </div>

            {/* Info Card */}
            <div className="mt-6 glass-card rounded-xl p-4 text-center">
              <p className="text-sm text-white text-opacity-90">
                <strong>First time?</strong> Register with your college email to join Campus Connect
              </p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<Login />, document.getElementById("root"));
  </script>
</body>
</html>